<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="google-site-verification" content="az36BCre_XxgT9qTSa9_eJwOM54MaIlKstfU0CO4FEI"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css"><link href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/uploads/image/logo180.png"><link rel="icon" type="image/png" sizes="32x32" href="/uploads/image/logo32.png"><link rel="icon" type="image/png" sizes="16x16" href="/uploads/image/logo16.png"><link rel="mask-icon" href="/uploads/image/logo300.svg" color="#222"><meta name="keywords" content="iwyy,java,spring,spring cloud,spring mvc,Java后端技术,微服务架构"><link rel="alternate" href="/atom.xml" title="iwyy's Blog" type="application/atom+xml"><meta name="description" content="或许你注定难以捉摸，侧身西望，似要望断这天涯南北东西之路。不应百花之邀，不解明月之情，孑然一人，默然自语，黯然伤神，在秋风中独自泪流，没了这砌下之路。奈何我拂了一身还满，猜不透，怎知我依旧陪你看遍了那个季节的花开花落，又怎知道我的心意，云卷云舒。因为，我只想与你相伴，共天涯……"><meta property="og:type" content="website"><meta property="og:title" content="iwyy&#39;s Blog"><meta property="og:url" content="http://www.iwyy.top/about/index.html"><meta property="og:site_name" content="iwyy&#39;s Blog"><meta property="og:description" content="或许你注定难以捉摸，侧身西望，似要望断这天涯南北东西之路。不应百花之邀，不解明月之情，孑然一人，默然自语，黯然伤神，在秋风中独自泪流，没了这砌下之路。奈何我拂了一身还满，猜不透，怎知我依旧陪你看遍了那个季节的花开花落，又怎知道我的心意，云卷云舒。因为，我只想与你相伴，共天涯……"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2017-12-31T04:20:04.068Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="iwyy&#39;s Blog"><meta name="twitter:description" content="或许你注定难以捉摸，侧身西望，似要望断这天涯南北东西之路。不应百花之邀，不解明月之情，孑然一人，默然自语，黯然伤神，在秋风中独自泪流，没了这砌下之路。奈何我拂了一身还满，猜不透，怎知我依旧陪你看遍了那个季节的花开花落，又怎知道我的心意，云卷云舒。因为，我只想与你相伴，共天涯……"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"6.0.0",sidebar:{position:"left",display:"always",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!0,fastclick:!0,lazyload:!0,tabs:!0,motion:{enable:!0,async:!0,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.iwyy.top/about/"><title>mysql高性能索引 | iwyy's Blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?9af9ad7600513d41fd2b2ad6c4633785";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">iwyy's Blog</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Life is so beautiful</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.iwyy.top/2018/mysql-index.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="iwyy"><meta itemprop="description" content=""><meta itemprop="image" content="/uploads/m.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="iwyy's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">mysql高性能索引</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-19T21:52:51+08:00">2018-01-19</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/sql/" itemprop="url" rel="index"><span itemprop="name">sql</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h1><p>索引由很多类型，可以为不同场景提供更好的性能，在mysql中索引是存储引擎层而不是服务器层实现的。不同存储引擎的索引工作方式也不一样，也不是所有存储引擎支持所有索引类型，其底层实现也可能不同。</p><h2 id="B-Tree索引"><a href="#B-Tree索引" class="headerlink" title="B-Tree索引"></a>B-Tree索引</h2><p>使用B-Tree数据结构来存储数据，大多数mysql引擎都支持这种索引，Archive引擎是个例外。<br>存储引擎以不同的方式使用B-Tree索引，性能也各不同，各有优劣。<br>例如，MyISAM使用前缀压缩使得索引更小，但InnoDB按照原数据格式进行存储。再如MyISAM索引通过数据的屋里位置引用被索引的行，而InnoDB根据主键引用被索引的行。<br>B-Tree索引对如下类型的查询有效（假设：key(name,dob)）：<br>1、全值匹配<br>比如查找姓名为Allen的人，出生于1996年的人<br>2、匹配最左前缀<br>比如查找姓名为Allen的人，即只是用索引的第一列<br>3、匹配列前缀<br>比如查找所有以J开头的姓的人。这里也只使用了索引的第一列。<br>4、匹配范围值<br>比如查找姓在Allen和Barrymore之间的人。这里也只使用了索引的第一列。<br>5、匹配某一列并范围匹配另一列<br>比如查找姓名Allen的人，出生1996到2005的人<br>B-Tree支持“值访问索引的查询”，即查询只需要访问索引，而不需要访问数据行，也叫做“覆盖索引”。<br>因为索引树中的节点是有序的，所以除了按值查找之外，索引还可以用order by操作。<br><a id="more"></a></p><h2 id="哈希索引"><a href="#哈希索引" class="headerlink" title="哈希索引"></a>哈希索引</h2><p>哈希索引基于哈希表实现，只有精确匹配索引所有的列的查询才有效。<br>mysql中只有Memory引擎显式的支持哈希索引，也是Memory的默认索引类型,Memory引擎同时也支持B-Tree索引。Memory引擎是支持费唯一哈希索引的，如果多个列的哈希值相同，索引会以链表的方式存放记录指针到同一个哈希条目中。<br>哈希索引查询的速度非常快，但是哈希索引也有很多限制：<br>1、哈希索引只包含哈希值和行指针，而不存储字段值，所以不能使用索引中的值来避免读取行。<br>2、哈希索引数据不是按照索引值顺序存储的，所以也无法用于排序<br>3、哈希索引不支持部分索引列的匹配查找，因为哈希索引始终是使用索引列的全部内容来计算哈希值的。<br>4、哈希索引只支持等值比较查询,包括=、IN()、&lt;=&gt;，不支持范围查询。<br>5、哈希索引的数据非常快，除非有很多哈希冲突，如果冲突很多的时候索引维护操作的代价也高，查找遍历链表代价也大。<br>因为这些限制，哈希索引只适用于某些特定的场合，而一旦适合则带来的性能提升非常显著。<br>InnoDB引擎有个特殊的功能叫做“自适应哈希索引”。当InnoDB注意到某些索引值被使用的非常频繁时，它会在内存中基于B-tree索引之上再创建一个哈希索引，这样就让B-Tree也有哈希索引的一些优点，比如快速的哈希查找，这是个完全自动的内部行为用户无法控制，但可以关闭该功能。<br>如果存储引擎不支持哈希索引，可以模拟想InnoDB一样创建哈希索引，这样可以享受一些哈希索引的遍历，比如只需要很小的索引就可以为超长的键创建索引，思路很简单：在B-Tree基础上创建一个伪哈希索引。<br>例如：<br>select id from url where url=”<a href="http://www.mysql.com" target="_blank" rel="noopener">http://www.mysql.com</a>“;<br>删除原来url列上的所以，新增一个url_rcc列，使用crc32做哈希，使用下面的方式查询：<br>select id from url where url = “<a href="http://www.mysql.com" target="_blank" rel="noopener">http://www.mysql.com</a>“<br>and url_rcc = crc32(“<a href="http://www.mysql.com" target="_blank" rel="noopener">http://www.mysql.com</a>“);<br>这样做新能会非常高，因为mysql优化器会使用这个选择性很高而体积很小的基于url_crc列的索引来完成查找。这样做需要维护哈希值可以使用触发器或者手动。如果这种方式不要使用sha1()和md5()作为哈希函数，因为这两个函数计算出来的哈希值非常长。</p><h2 id="空间数据索引（R-Tree）"><a href="#空间数据索引（R-Tree）" class="headerlink" title="空间数据索引（R-Tree）"></a>空间数据索引（R-Tree）</h2><p>MyISAM表支持空间所以呢，可以用作地理数据存储。</p><h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><p>它是查找文本中的关键词，而不是直接比较索引中的值。</p><h1 id="索引的优点"><a href="#索引的优点" class="headerlink" title="索引的优点"></a>索引的优点</h1><p>1、大大减少了服务器需要扫描的数据量。<br>2、可以帮助服务器避免排序和临时表。<br>3、可以随机I/O变为顺序I/O。</p><h1 id="高性能索引策略"><a href="#高性能索引策略" class="headerlink" title="高性能索引策略"></a>高性能索引策略</h1><h2 id="独立的列"><a href="#独立的列" class="headerlink" title="独立的列"></a>独立的列</h2><p>“独立的列”是指索引列不能使表达式的一部分也不能是函数的参数<br>例如：select id from aa where id+1=5;<br>正确写法：select id from aa where id=4;</p><h2 id="前缀索引和索引的选择性"><a href="#前缀索引和索引的选择性" class="headerlink" title="前缀索引和索引的选择性"></a>前缀索引和索引的选择性</h2><p>有时候需要索引很长的字符列，这会让索引变得大且慢。一个策略是上面提到的通过模拟哈希索引，另一种就是前缀索引。<br>通常可以索引开始的部分字符，这样可以一打打节约索引空间，提高效率。但这样会降低索引的选择性。索引的选择性是指不重复的索引值和数据表的记录总数的比值，范围。索引的选择性越高则查询效率越高，因为可以过滤掉更多的行。唯一索引的选择性是1，性能是最好的。<br>创建前缀索引：alter table aa add key(name(7))<br>mysql前缀索引无法做order by 和group by，也无法使用前缀索引做覆盖扫描。</p><h2 id="多列索引"><a href="#多列索引" class="headerlink" title="多列索引"></a>多列索引</h2><p>给多个列创建独立的单例索引，多列索引大部分情况下并不能提高mysql的查询性能，mysql5.0之后更是引入一种叫索引合并的策略，一定程度上可以使用表上的多个单列索引来定位指定的行。索引合并策略是一种优化的结果，但实际上更多的说明了表上的索引建的非常糟糕：<br>1、当出现服务器对多个索引做相交操作（通常有多个and条件），通常以位置需要一个包含所有相关列的多列索引，而不是多个多里的单列索引。<br>2、当服务器需要对多个索引做联合操作时（通常是多个or条件）。</p><h2 id="选择合适的索引列顺序"><a href="#选择合适的索引列顺序" class="headerlink" title="选择合适的索引列顺序"></a>选择合适的索引列顺序</h2><p>讲选择性最高的列放到索引最前列。</p><h2 id="聚簇索引和非聚簇索引"><a href="#聚簇索引和非聚簇索引" class="headerlink" title="聚簇索引和非聚簇索引"></a>聚簇索引和非聚簇索引</h2><p>聚簇索引并不是一个单独的索引类型，而是一种数据存储方式。<br>B+Tree结构都可以用在MyISAM和InnoDB上。mysql中，不同的存储引擎对索引的实现方式不同。<br>B+Tree示意图<br><img src="/js/lazyload-plugin/loading.svg" data-original="/uploads/image/mysql-index1.png"><br>聚集索引和非聚集索引原理图<br><img src="/js/lazyload-plugin/loading.svg" data-original="/uploads/image/mysql-index2.png"></p><h3 id="聚簇索引"><a href="#聚簇索引" class="headerlink" title="聚簇索引"></a>聚簇索引</h3><p>聚簇索引的数据的物理存放顺序与索引顺序是一致的，即：只要索引是相邻的，那么对应的数据一定也是相邻地存放在磁盘上的。聚簇索引要比非聚簇索引查询效率高很多。<br>聚集索引这种主+辅索引的好处是，当发生数据行移动或者页分裂时，辅助索引树不需要更新，因为辅助索引树存储的是主索引的主键关键字，而不是数据具体的物理地址。<br>InnoDB使用的是聚簇索引，将主键组织到一棵B+树中，而行数据就储存在叶子节点上，若使用”where id = 14”这样的条件查找主键，则按照B+树的检索算法即可查找到对应的叶节点，之后获得行数据。若对Name列进行条件搜索，则需要两个步骤：第一步在辅助索引B+树中检索Name，到达其叶子节点获取对应的主键。第二步使用主键在主索引B+树种再执行一次B+树检索操作，最终到达叶子节点即可获取整行数据。</p><h3 id="非聚簇索引"><a href="#非聚簇索引" class="headerlink" title="非聚簇索引"></a>非聚簇索引</h3><p>非聚集索引，类似于图书的附录，那个专业术语出现在哪个章节，这些专业术语是有顺序的，但是出现的位置是没有顺序的。每个表只能有一个聚簇索引，因为一个表中的记录只能以一种物理顺序存放。但是，一个表可以有不止一个非聚簇索引。<br>MyISAM的是非聚簇索引，B+Tree的叶子节点上的data，并不是数据本身，而是数据存放的地址。主索引和辅助索引没啥区别，只是主索引中的key一定得是唯一的。这里的索引都是非聚簇索引。非聚簇索引的两棵B+树看上去没什么不同，节点的结构完全一致只是存储的内容不同而已，主键索引B+树的节点存储了主键，辅助键索引B+树存储了辅助键。表数据存储在独立的地方，<br>这两颗B+树的叶子节点都使用一个地址指向真正的表数据，对于表数据来说，这两个键没有任何差别。由于索引树是独立的，通过辅助键检索无需访问主键的索引树</p><h2 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h2><p>覆盖索引又可以称为索引覆盖。<br>解释一： 就是select的数据列只用从索引中就能够取得，不必从数据表中读取，换句话说查询列要被所使用的索引覆盖。<br>解释二： 索引是高效找到行的一个方法，当能通过检索索引就可以读取想要的数据，那就不需要再到数据表中读取行了。如果一个索引包含了（或覆盖了）满足查询语句中字段与条件的数据就叫做覆盖索引。<br>解释三：是非聚集组合索引的一种形式，它包括在查询里的Select、Join和Where子句用到的所有列（即建立索引的字段正好是覆盖查询语句[select子句]与查询条件[Where子句]中所涉及的字段，也即，索引包含了查询正在查找的所有数据）<br>不是所有类型的索引都可以成为覆盖索引，覆盖索引必须要存储索引列的值，而哈希索引、空间索引、全文索引都不存储列的值，所以mysql只能用B-Tree索引做覆盖索引。不同的存储引擎实现覆盖索引的方式也不同，而且也不是所有的存储引擎都支持覆盖索引（memory存储引擎就不支持覆盖索引，不排除未来支持）</p><h3 id="覆盖索引的好处"><a href="#覆盖索引的好处" class="headerlink" title="覆盖索引的好处"></a>覆盖索引的好处</h3><p>1、索引条目通常远小于数据行大小，减少数据访问和I/O开销。<br>2、由于InnoDB聚簇索引，覆盖索引对InnoDb表特别有用，InnoDb的二级索引在叶子节点中保存了行的主键值，如果二级主键可以覆盖查询，可以避免对主键索引的二次查询。</p><h2 id="使用索引描述来排序"><a href="#使用索引描述来排序" class="headerlink" title="使用索引描述来排序"></a>使用索引描述来排序</h2><p>mysql使用两种方式可以生成有序的结果：通过排序操作或者按索引顺序扫描。如果explain出来的type列值为“index”，则说明mysql使用了索引扫描来做排序。<br>mysql可以使用同一个索引既满足排序有用于查找，如果可能，设计索引时应该尽可能地同时满足这两种任务。<br>只有当索引的列顺序和order by 子句的顺序完全一致，并且所有列的排序方向（要么都是desc，要么都是asc）都一样时，mysql才能使用索引来对结果做排序。如果查询多张关联表，则只有当order by 子句引用的字段全部为第一个表时，才能使用做排序。<br>有一种情况下order by子句可以不满足索引的最左前缀的要求，就是前导列为常量的时候。如果where子句或者join子句中这些列制定了常量就可以弥补索引的不足。<br>表指定索引 key（a,b,c）例子：<br>where a=1 order by b,c;<br>where a=1 order by b;<br>where a&gt;1 order by a,b;<br>一下是错误的例子：<br>where a =1 order by b desc,c asc;<br>where a =1 order by c;<br>where a&gt;1 order by b,c;<br>where a =1 and b in(1,2) order by c;</p><h2 id="冗余和重复索引"><a href="#冗余和重复索引" class="headerlink" title="冗余和重复索引"></a>冗余和重复索引</h2><p>mysql允许在相同的列上创建多个索引。mysql需要单独维护重复的索引，这会影响性能。应该避免创建重复索引，发现以后应该立即移除。<br>下面的代码创建了三个重复的索引：<br>create table text(id int not null PRIMARY KEY,<br>UNIQUE(ID),INDEX(ID)<br>)ENGIN=InnoDB;<br>冗余索引和重复索引有些不同，如果创建了索引(A,B),在创建索引(A)就是冗余索引，因为这只是前一个索引的前缀索引。如果在创建(B,A),则不是冗余索引，(B)也不是。冗余索引通常只是对B-tree索引来说的。<br>大多数情况不需要冗余索引，但也有出于性能考虑需要冗余索引，因为扩展已有的索引会导致变得太大，从而影响其他使用该索引的查询的性能。<br>表中的索引越多插入速度回越慢，一般来说，增加新索引将会导致insert、update、delete等操作的速度变慢，特别是新增索引达到了内存瓶颈的时候。</p><h2 id="未使用的索引"><a href="#未使用的索引" class="headerlink" title="未使用的索引"></a>未使用的索引</h2><p>有些服务器永远用不到的索引。建议考虑删除。<br>怎样检测未使用的索引请google或者百度。</p><h2 id="索引和锁"><a href="#索引和锁" class="headerlink" title="索引和锁"></a>索引和锁</h2><p>索引可以让查询锁定更少的行。<br>InnoDB只有在访问行的时候才会对其加锁，而索引能减少InnoDB访问的行数，从而减少锁的数量。</p><h1 id="MySQL索引失效的几种情况"><a href="#MySQL索引失效的几种情况" class="headerlink" title="MySQL索引失效的几种情况"></a>MySQL索引失效的几种情况</h1><h2 id="索引不存储null值"><a href="#索引不存储null值" class="headerlink" title="索引不存储null值"></a>索引不存储null值</h2><p>更准确的说，单列索引不存储null值，复合索引不存储全为null的值。索引不能存储Null，所以对这列采用is null条件时，因为索引上根本<br>没Null值，不能利用到索引，只能全表扫描。<br>为什么索引列不能存Null值？<br>将索引列值进行建树，其中必然涉及到诸多的比较操作。Null值的特殊性就在于参与的运算大多取值为null。<br>这样的话，null值实际上是不能参与进建索引的过程。也就是说，null值不会像其他取值一样出现在索引树的叶子节点上。</p><h2 id="不适合键值较少的列（重复数据较多的列）"><a href="#不适合键值较少的列（重复数据较多的列）" class="headerlink" title="不适合键值较少的列（重复数据较多的列）"></a>不适合键值较少的列（重复数据较多的列）</h2><p>如果某个数据列里包含着许多重复的值，就算为它建立了索引也不会有很好的效果。比如说，如果某个数据列里包含了净是些诸如“0/1”或“Y/N”等值，就没有必要为它创建一个索引。</p><h2 id="前导模糊查询不能利用索引-like-‘-XX’或者like-‘-XX-’"><a href="#前导模糊查询不能利用索引-like-‘-XX’或者like-‘-XX-’" class="headerlink" title="前导模糊查询不能利用索引(like ‘%XX’或者like ‘%XX%’)"></a>前导模糊查询不能利用索引(like ‘%XX’或者like ‘%XX%’)</h2><p>假如有这样一列code的值为’AAA’,’AAB’,’BAA’,’BAB’ ,如果where code like ‘%AB’条件，由于前面是模糊的，所以不能利用索引的顺序，必须一个个去找，看是否满足条件。这样会导致全索引扫描或者全表扫描。如果是这样的条件where code like ‘A % ‘，就可以查找CODE中A开头的CODE的位置，当碰到B开头的数据时，就可以停止查找了，因为后面的数据一定不满足要求。这样就可以利用索引了。</p><h2 id="in-失效的情况"><a href="#in-失效的情况" class="headerlink" title="in 失效的情况"></a>in 失效的情况</h2><p>eq_range_index_dive_limit这个参数影响in是否使用索引， 5.6 默认值是10 5.7 默认值是 200</p><h2 id="mysql自动优化"><a href="#mysql自动优化" class="headerlink" title="mysql自动优化"></a>mysql自动优化</h2><p>如果mysql估计使用全表扫描要比使用索引快,则不使用索引。如果需要使用索引可以强制使用索引。<br>mysql强制使用索引:force index(索引名或者主键PRI)<br>例如:<br>select <em>from table force index(PRI) limit 2;(强制使用主键)<br>select </em>from table force index(ziduan1_index) limit 2;(强制使用索引”ziduan1_index”)<br>select <em>from table force index(PRI,ziduan1_index) limit 2;(强制使用索引”PRI和ziduan1_index”)<br>mysql禁止某个索引：ignore index(索引名或者主键PRI)<br>例如:<br>select </em>from table ignore index(PRI) limit 2;(禁止使用主键)<br>select <em>from table ignore index(ziduan1_index) limit 2;(禁止使用索引”ziduan1_index”)<br>select </em>from table ignore index(PRI,ziduan1_index) limit 2;(禁止使用索引”PRI,ziduan1_index”)</p><h2 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h2><p>索引字段类型使用<br>explain extended select uid from user where mo = 123445 limit 0,1<br>原因：索引隐式转换,mo是varchar类型,这里使用的是数字,索引使用无效（数据类型以及字符集定义不当导致）<br>在JOIN操作中（需要从多个数据表提取数据时），MYSQL只有在主键和外键的数据类型相同时才能使用索引，否则即使建立了索引也不会使用</p><h2 id="索引列不能参与计算"><a href="#索引列不能参与计算" class="headerlink" title="索引列不能参与计算"></a>索引列不能参与计算</h2><p>保持列“干净”，比如from_unixtime(create_time) = ’2014-05-29’就不能使用到索引，原因很简单，b+树中存的都是数据表中的字段值，但进行检索时，需要把所有元素都应用函数才能比较，显然成本太大。所以语句应该写成create_time = unix_timestamp(’2014-05-29’);</p><h1 id="Explain优化查询检测"><a href="#Explain优化查询检测" class="headerlink" title="Explain优化查询检测"></a>Explain优化查询检测</h1><h2 id="禁止缓存"><a href="#禁止缓存" class="headerlink" title="禁止缓存"></a>禁止缓存</h2><p>在测试sql语句性能时有时需要禁用缓存， 下面是几种不同的实现方式， 供参考使用：</p><ol><li>通过sql的select语句中添加SQL_NO_CACHE修饰来禁用查询缓存<br>SELECT SQL_NO_CACHE * FROM TABLE_NAME</li><li>通过set 变量来实现禁用缓存<br>SET SESSION query_cache_type=0;</li><li>通过reset指令来重置缓存<br>RESET QUERY CACHE<br>以上三种方法都可以达到测试mysql性能时清缓存的目的。<h2 id="MySQL执行计划调用方式"><a href="#MySQL执行计划调用方式" class="headerlink" title="MySQL执行计划调用方式"></a>MySQL执行计划调用方式</h2>1.EXPLAIN SELECT ……<br>变体：<br>2.EXPLAIN EXTENDED SELECT ……<br>将执行计划”反编译”成SELECT语句，运行SHOW WARNINGS<br>可得到被MySQL优化器优化后的查询语句<br>3.EXPLAIN PARTITIONS SELECT ……<br>用于分区表的EXPLAIN生成QEP的信息<h2 id="关于explain选项"><a href="#关于explain选项" class="headerlink" title="关于explain选项"></a>关于explain选项</h2>下面是一个实例：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select products_id from products limit 1;</span><br><span class="line">+----+-------------+----------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| id | select_type | table  | type | possible_keys | key   | key_len | ref | rows | Extra    |</span><br><span class="line">+----+-------------+----------+-------+---------------+---------+---------+------+------+-------------+</span><br><span class="line">| 1 | SIMPLE   | products | index | NULL     | PRIMARY | 4    | NULL | 3113 | Using index |</span><br><span class="line">+----+-------------+----------+-------+---------------+---------+---------+------+------+-------------+</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="id"><a href="#id" class="headerlink" title="id"></a>id</h3><p>MySQL  Query  Optimizer选定的执行计划中查询的序列号。<br>表示查询中执行select子句或操作表的顺序，id值越大优先级越高，越先被执行。id相同，执行顺序由上至下</p>
<h3 id="select-type"><a href="#select-type" class="headerlink" title="select_type"></a>select_type</h3><p>1、SIMPLE：简单的select查询，不使用union及子查询<br>2、PRIMARY：最外层的select查询<br>3、UNION：UNION中的第二个或随后的select查询，不依赖于外部查询的结果集<br>4、DEPENDENT UNION：UNION中的第二个或随后的select查询，依赖于外部查询的结果集<br>5、UNION RESULT： UNION查询的结果集SUBQUERY子查询中的第一个select查询，不依赖于外部查询的结果集<br>6、DEPENDENT SUBQUERY:子查询中的第一个select查询，依赖于外部查询的结果集DERIVED用于from子句里有子查询的情况。<br>    MySQL会递归执行这些子查询，把结果放在临时表里。<br>7、UNCACHEABLE SUBQUERY:结果集不能被缓存的子查询，必须重新为外层查询的每一行进行评估<br>8、UNCACHEABLE UNION:UNION中的第二个或随后的select查询，属于不可缓存的子查询</p>
<h3 id="table"><a href="#table" class="headerlink" title="table"></a>table</h3><p>1、system：表仅有一行(系统表)。这是const连接类型的一个特例。<br>2、const：const用于用常数值比较PRIMARY KEY时。当查询的表仅有一行时，使用system。<br>3、eq_ref：除const类型外最好的可能实现的连接类型。它用在一个索引的所有部分被连接使用并且索引是UNIQUE或PRIMARY KEY，<br>    对于每个索引键，表中只有一条记录与之匹配。<br>4、ref：连接不能基于关键字选择单个行，可能查找到多个符合条件的行。叫做ref是因为索引要跟某个参考值相比较。<br>    这个参考值或者是一个常数，或者是来自一个表里的多表查询的结果值。<br>5、ref_or_null：如同ref，但是MySQL必须在初次查找的结果里找出null条目，然后进行二次查找。<br>6、index_merge：说明索引合并优化被使用了。<br>7、unique_subquery：在某些IN查询中使用此种类型，而不是常规的ref：<br>    value IN (SELECT primary_key FROM single_table WHERE some_expr)<br>    index_subquery在某些IN查询中使用此种类型，与unique_subquery类似，但是查询的是非唯一性索引：<br>    value IN (SELECT key_column FROM single_table WHERE some_expr)<br>8、range：只检索给定范围的行，使用一个索引来选择行。key列显示使用了哪个索引。<br>    当使用=、&lt;&gt;、&gt;、&gt;=、&lt;、&lt;=、IS NULL、&lt;=&gt;、BETWEEN或者IN操作符，用常量比较关键字列时，可以使用range。<br>9、index：全表扫描，只是扫描表的时候按照索引次序进行而不是行。主要优点就是避免了排序，但是开销仍然非常大。<br>10、all：最坏的情况，从头到尾全表扫描</p>
<h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>表示MySQL在表中找到所需行的方式，又称“访问类型”，常见类型如下:<br> ALL, index,  range, ref, eq_ref, const, system, NULL<br>从左到右，性能从最差到最好<br>a. ALL：Full Table Scan， MySQL将遍历全表以找到匹配的行<br>b. index：Full Index Scan，index与ALL区别为index类型只遍历索引树<br>c. range:索引范围扫描，对索引的扫描开始于某一点，返回匹配值域的行。显而易见的索引范围扫描是带有between或者where子句里带有&lt;, &gt;查询。当mysql使用索引去查找一系列值时，例如IN()和OR列表，也会显示range（范围扫描）,当然性能上面是有差异的。<br>d. ref：使用非唯一索引扫描或者唯一索引的前缀扫描，返回匹配某个单独值的记录行<br>e. eq_ref：类似ref，区别就在使用的索引是唯一索引，对于每个索引键值，表中只有一条记录匹配，简单来说，就是多表连接中使用primary key或者 unique key作为关联条件<br>f. const、system：当MySQL对查询某部分进行优化，并转换为一个常量时，使用这些类型访问。如将主键置于where列表中，MySQL就能将该查询转换为一个常量<br>g. NULL：MySQL在优化过程中分解语句，执行时甚至不用访问表或索引，例如从一个索引列里选取最小值可以通过单独索引查找完成。</p>
<h3 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys"></a>possible_keys</h3><p>指出MySQL能使用哪个索引在表中找到记录，查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询使用,如果为空，说明没有可用的索引</p>
<h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><p>显示MySQL在查询中实际使用的索引，若没有使用索引，显示为NULL<br>mysql实际从possible_key选择使用的索引。如果为null，则没有使用索引。很少的情况下，mysql会选择优化不足的索引。这种情况下，可以在select语句中使用use  index（indexname）来强制使用一个索引或者用ignore  index（indexname）来强制mysql忽略索引</p>
<h3 id="key-len"><a href="#key-len" class="headerlink" title="key_len"></a>key_len</h3><p>表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度（key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的）<br>在不损失精确性的情况下，长度越短越好</p>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p>表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值</p>
<h3 id="rows"><a href="#rows" class="headerlink" title="rows"></a>rows</h3><p>表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数</p>
<h3 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h3><p>1、Distinct<br>一旦mysql找到了与行相联合匹配的行，就不再搜索了。<br>2、Not exists<br>mysql 优化了LEFT JOIN，一旦它找到了匹配LEFT JOIN标准的行，就不再搜索了。<br>3、Range checked for each<br>Record（index map:#）没有找到理想的索引，因此对于从前面表中来的每一个行组合，mysql检查使用哪个索引，并用它来从表中返回行。这是使用索引的最慢的连接之一。<br>4、Using filesort<br>表示MySQL会对结果使用一个外部索引排序，而不是从表里按索引次序读到相关内容。可能在内存或者磁盘上进行排序。MySQL中无法利用索引完成的排序操作称为“文件排序”。<br>5、Using index<br>该值表示相应的select操作中使用了覆盖索引（Covering Index）,列数据是从仅仅使用了索引中的信息而没有读取实际的行动的表返回的，这发生在对表的全部的请求列都是同一个索引的部分的时候。<br>6、Using temporary<br>mysql需要创建一个临时表来存储结果，这通常发生在对不同的列集进行ORDER BY上，而不是GROUP BY上。<br>表示MySQL需要使用临时表来存储结果集，常见于排序和分组查询<br>这个值表示使用了内部临时(基于内存的)表。一个查询可能用到多个临时表。有很多原因都会导致MySQL在执行查询期间创建临时表。两个常见的原因是在来自不同表的上使用了DISTINCT,或者使用了不同的ORDER BY和GROUP BY列。可以强制指定一个临时表使用基于磁盘的MyISAM存储引擎。这样做的原因主要有两个：<br>1)内部临时表占用的空间超过min(tmp_table_size，max_heap_table_size)系统变量的限制<br>2)使用了TEXT/BLOB 列<br>7、Using where<br>使用了WHERE从句来限制哪些行将与下一张表匹配或者是返回给用户。如果不想返回表中的全部行，并且连接类型ALL或index，这就会发生，或者是查询有问题。。许多where条件里涉及索引中的列，当（并且如果）它读取索引时，就能被存储引擎检验，因此不是所有带where字句的查询都会显示”Using where”。有时”Using where”的出现就是一个暗示：查询可受益与不同的索引。<br>8、Using join buffer<br>改值强调了在获取连接条件时没有使用索引，并且需要连接缓冲区来存储中间结果。如果出现了这个值，那应该注意，根据查询的具体情况可能需要添加索引来改进能。<br>9、Impossible where<br>这个值强调了where语句会导致没有符合条件的行。<br>10、 Select tables optimized away<br>这个值意味着仅通过使用索引，优化器可能仅从聚合函数结果中返回一行.<br>11、Index merges<br>当MySQL 决定要在一个给定的表上使用超过一个索引的时候，就会出现以下格式中的一个，详细说明使用的索引以及合并的类型。<br>Using sort_union(…)<br>Using union(…)<br>Using intersect(…)</p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>• EXPLAIN不会告诉你关于触发器、存储过程的信息或用户自定义函数对查询的影响情况<br>• EXPLAIN不考虑各种Cache<br>• EXPLAIN不能显示MySQL在执行查询时所作的优化工作<br>• 部分统计信息是估算的，并非精确值<br>• EXPALIN只能解释SELECT操作，其他操作要重写为SELECT后查看执行计划。<br>参考<br>（1）《高性能MySQL》<br>（2）《数据结构与算法分析》</p><script src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script>
      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    iwyy
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://www.iwyy.top/2018/mysql-index.html" title="mysql高性能索引">http://www.iwyy.top/2018/mysql-index.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
		  <a href="/tags/mysql/" rel="tag"><i class="fa fa-tag"></i> mysql</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/mysql-classic-case.html" rel="next" title="mysql使用经典案例">
                <i class="fa fa-chevron-left"></i> mysql使用经典案例
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/m.jpg" alt="iwyy">
            
              <p class="site-author-name" itemprop="name">iwyy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#索引类型"><span class="nav-number">1.</span> <span class="nav-text">索引类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#B-Tree索引"><span class="nav-number">1.1.</span> <span class="nav-text">B-Tree索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#哈希索引"><span class="nav-number">1.2.</span> <span class="nav-text">哈希索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#空间数据索引（R-Tree）"><span class="nav-number">1.3.</span> <span class="nav-text">空间数据索引（R-Tree）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#全文索引"><span class="nav-number">1.4.</span> <span class="nav-text">全文索引</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#索引的优点"><span class="nav-number">2.</span> <span class="nav-text">索引的优点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#高性能索引策略"><span class="nav-number">3.</span> <span class="nav-text">高性能索引策略</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#独立的列"><span class="nav-number">3.1.</span> <span class="nav-text">独立的列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前缀索引和索引的选择性"><span class="nav-number">3.2.</span> <span class="nav-text">前缀索引和索引的选择性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多列索引"><span class="nav-number">3.3.</span> <span class="nav-text">多列索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#选择合适的索引列顺序"><span class="nav-number">3.4.</span> <span class="nav-text">选择合适的索引列顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#聚簇索引和非聚簇索引"><span class="nav-number">3.5.</span> <span class="nav-text">聚簇索引和非聚簇索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#聚簇索引"><span class="nav-number">3.5.1.</span> <span class="nav-text">聚簇索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#非聚簇索引"><span class="nav-number">3.5.2.</span> <span class="nav-text">非聚簇索引</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#覆盖索引"><span class="nav-number">3.6.</span> <span class="nav-text">覆盖索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#覆盖索引的好处"><span class="nav-number">3.6.1.</span> <span class="nav-text">覆盖索引的好处</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用索引描述来排序"><span class="nav-number">3.7.</span> <span class="nav-text">使用索引描述来排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#冗余和重复索引"><span class="nav-number">3.8.</span> <span class="nav-text">冗余和重复索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#未使用的索引"><span class="nav-number">3.9.</span> <span class="nav-text">未使用的索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引和锁"><span class="nav-number">3.10.</span> <span class="nav-text">索引和锁</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL索引失效的几种情况"><span class="nav-number">4.</span> <span class="nav-text">MySQL索引失效的几种情况</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#索引不存储null值"><span class="nav-number">4.1.</span> <span class="nav-text">索引不存储null值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不适合键值较少的列（重复数据较多的列）"><span class="nav-number">4.2.</span> <span class="nav-text">不适合键值较少的列（重复数据较多的列）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前导模糊查询不能利用索引-like-‘-XX’或者like-‘-XX-’"><span class="nav-number">4.3.</span> <span class="nav-text">前导模糊查询不能利用索引(like ‘%XX’或者like ‘%XX%’)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#in-失效的情况"><span class="nav-number">4.4.</span> <span class="nav-text">in 失效的情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql自动优化"><span class="nav-number">4.5.</span> <span class="nav-text">mysql自动优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#隐式转换"><span class="nav-number">4.6.</span> <span class="nav-text">隐式转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引列不能参与计算"><span class="nav-number">4.7.</span> <span class="nav-text">索引列不能参与计算</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Explain优化查询检测"><span class="nav-number">5.</span> <span class="nav-text">Explain优化查询检测</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#禁止缓存"><span class="nav-number">5.1.</span> <span class="nav-text">禁止缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL执行计划调用方式"><span class="nav-number">5.2.</span> <span class="nav-text">MySQL执行计划调用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于explain选项"><span class="nav-number">5.3.</span> <span class="nav-text">关于explain选项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#id"><span class="nav-number">5.3.1.</span> <span class="nav-text">id</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#select-type"><span class="nav-number">5.3.2.</span> <span class="nav-text">select_type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#table"><span class="nav-number">5.3.3.</span> <span class="nav-text">table</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#type"><span class="nav-number">5.3.4.</span> <span class="nav-text">type</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#possible-keys"><span class="nav-number">5.3.5.</span> <span class="nav-text">possible_keys</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#key"><span class="nav-number">5.3.6.</span> <span class="nav-text">key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#key-len"><span class="nav-number">5.3.7.</span> <span class="nav-text">key_len</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ref"><span class="nav-number">5.3.8.</span> <span class="nav-text">ref</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rows"><span class="nav-number">5.3.9.</span> <span class="nav-text">rows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extra"><span class="nav-number">5.3.10.</span> <span class="nav-text">extra</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结："><span class="nav-number">5.3.11.</span> <span class="nav-text">总结：</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">iwyy</span></div><div class="powered-by">Powered by <a href="https://console.upyun.com/register/?invite=rJOaeBqVf" title="又拍云" target="_blank"><img src="/uploads/image/upyun_logo.png" alt="UPYUN"></a></div><span class="post-meta-divider">|</span><div class="theme-info"><span>Hosted by <a href="https://pages.coding.me" target="_blank">Coding Pages</a></span></div>
        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script>





  



  






  















  
  
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js"></script>

  <script type="text/javascript" src="/js/src/motion.js"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js"></script>
<script type="text/javascript" src="/js/src/post-details.js"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>